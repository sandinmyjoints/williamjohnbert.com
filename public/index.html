
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>William John Bert</title>
  <meta name="author" content="William John Bert">

  
  <meta name="description" content="An uncaught exception in our Node app was causing not only one, but two and then
three workers to die. (Fortunately, we hardly ever encounter &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://williamjohnbert.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="William John Bert" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1913538-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">William John Bert</a></h1>
  
    <h2>Loves to write words and code.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:williamjohnbert.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/09/why-chrome-sometimes-sends-the-same-post-multiple-times/">How Legit HTTP (With an Async Io Assist) Massacred My Node Workers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-10T18:55:00-04:00" pubdate data-updated="true">Sep 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>An uncaught exception in our Node app was causing not only one, but two and then
three workers to die. (Fortunately, we hardly ever encounter uncaught
exceptions. Really, just this one since launch a few months ago. We&#8217;re Node
studs! Right?)</p>

<p>The funny thing is that we&#8217;re using Express, which (via Connect) wraps each
request / response in a try / catch. And we use Express&#8217;s error handler, which
returns 500 on unhandled errors.</p>

<p>Another funny thing is we use cluster, which isolates workers from each other.
They live in separate, solipsistic processes.</p>

<p>But instead of returning 500, our worker simply died. And, as if in sympathy,
the rest immediately followed.</p>

<p>Time to get to the bottom of this. A Node stud like me can figure it out. No
sweat. Right?</p>

<p>For a sanity check, I went to Chrome and Firefox&#8217;s network inspectors. Only one
POST, the bad request that triggered the exception. Everything else looks
normal. Sanity: verified.</p>

<p>Then it was on to the
<a href="http://nodejs.org/docs/latest/api/cluster.html#cluster_how_it_works">cluster module</a>.
That magical &#8220;OS load balancing&#8221; seemed highly suspicious. But nope, I asked in
#nodejs and they said that only applies at the TCP connection level. Once a
connection is assigned to a worker, it never goes to another worker. Meaning
that the bad request was isolated&mdash;only the worker who received the initial
connection could encounter it.</p>

<p>But the workers kept on dying.</p>

<p>These workers morted out fast. They didn&#8217;t even return 500, or any kind of
response. The more I thought about it, that didn&#8217;t really seem right. Not right
at all. Why no 500?</p>

<p>But I can only tackle one mystery at a time. I wanted to understand: why did so
many workers die?</p>

<p>Furious googling ensued. My efforts were rewarded with this nugget:</p>

<blockquote><p>If an HTTP/1.1 client sends a request which includes a request body, but which
does not include an Expect request-header field with the “100-continue”
expectation, and if the client is not directly connected to an HTTP/1.1 origin
server, and if the client sees the connection close before receiving any status
from the server, the client SHOULD retry the request.</p></blockquote>

<p><small>(From the
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.4">HTTP 1.1 spec, RFC 2616</a>.
<a href="http://stackoverflow.com/a/14345476/599258">Original hat tip</a>, which links to
this
<a href="http://geek.starbean.net/?p=393">informative post about double HTTP requests</a>.)</small></p>

<p>My mind was somewhat blown. The browers were right after all. They were just
following HTTP. And&mdash;helpfully!&mdash;hiding the resent POSTs from the network
inspector.</p>

<p>But POSTs are dangerous. They mutate resources! I must only click the <em>Order</em>
button once or I may get charged multiple times!</p>

<p>I had a thought. One I have often, yet each time, it seems new again: <em>I have
much to learn</em>.</p>

<p>Back to the 500s. Or lack thereof. Which got funnier still when I realized that
other errors in our controllers that threw exceptions <em>did</em> return 500s. Being a
hands-on kind of guy, I added one right at the top of a route controller: <code>throw
new Error("uh-oh")</code>. My dev server spat back: <code>500 Error: uh-oh</code>.</p>

<p>So why did that one particular error never, ever return a 500, or any response
of any kind?</p>

<p>It&#8217;s my fault, really. I&#8217;m still a Node newbie (I must never forget this). I had
missed that because async IO callbacks occur in a different call stack from the
request / response cyle, one that originates from the event loop,
<a href="http://stackoverflow.com/questions/13228649/unable-to-handle-exception-with-node-js-domains-using-express/13240256#13240256">Express&#8217;s try / catch doesn&#8217;t catch them</a>.</p>

<p>It makes total sense. I have much to learn.</p>

<p>So what to do? <code>require('domain')</code> to the rescue. I can write some middleware (a
bit of <a href="https://github.com/brianc/node-domain-middleware">this</a>, a dash of
<a href="https://github.com/mathrawka/express-domain-errors">that</a>) to wrap the request
/ response in a domain.</p>

<p>But how do I get this domain into my controller? My solution was to attach it to
<code>res.locals._domain</code>. Good solution? I don&#8217;t know. I suspect there&#8217;s a better
way. Good enough? It solved my immediate problem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Model</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span> <span class="nx">value</span><span class="p">},</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">_domain</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// This callback can throw all it wants. My domain will catch it.</span>
</span><span class='line'><span class="p">}));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sweet. Now, armed with a reference to <code>res</code> in the domain error handler, I can
return a 500. Voila, the browser gets its response. No more helpful resent
POSTs. The silent gratitude of the spared workers is its own reward.</p>

<p>Except, do I need to bind every
<a href="https://github.com/LearnBoost/mongoose/pull/1337">mongoose</a> and
<a href="https://github.com/joyent/node/issues/3908">other kind of async IO operation</a>
in my app? There are many.</p>

<p>Many.</p>

<p>I have much to learn.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/allow-cors-with-localhost-in-chrome/">Allow CORS With Localhost in Chrome</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-25T19:04:00-04:00" pubdate data-updated="true">Jun 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I spent some time wrestling with the notorious
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Same_origin_policy_for_JavaScript">same origin policy</a>
in order to get CORS
(<a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS">cross-origin resource sharing</a>)
working in Chrome for development work I was doing between two applications
running on localhost. Setting the <code>Access-Control-Allow-Origin</code> header to <code>*</code>
seemed to have no effect, and
<a href="https://code.google.com/p/chromium/issues/detail?id=67743">this bug report</a>
nearly led me to believe that was due to a bug in Chrome that made CORS with
localhost impossible. It&#8217;s not. It turned out that I also needed some other
CORs-related headers: <code>Access-Control-Allow-Headers</code> and
<code>Access-Control-Allow-Methods</code>.</p>

<p>This (slightly generalized) snippet of <a href="http://expressjs.com">Express.js</a>
middleware is what ended up working for me:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/api/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span> <span class="s2">&quot;Cache-Control, Pragma, Origin, Authorization, Content-Type, X-Requested-With&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">,</span> <span class="s2">&quot;GET, PUT, POST&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that, Chrome started making OPTIONS requests when I wanted to POST from
localhost:3001 to localhost:2002. It seems that using <code>contentType:
application/json</code> for POSTs forces CORS preflighting, which surprised me since
it seems like a common case for APIs, but no matter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/api/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="s2">&quot;options&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">204</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/emacs-cl-lib-madness/">Emacs Cl-lib Madness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-27T15:52:00-04:00" pubdate data-updated="true">May 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Emacs 24.3 renamed the Common Lisp emulation package from <code>cl</code> to <code>cl-lib</code>. The
<a href="http://www.gnu.org/software/emacs/NEWS.24.3">release notes</a> say that <code>cl</code> in
24.3 is now &#8220;a bunch of aliases that provide the old, non-prefixed names&#8221;, but I
encountered some problems with certain packages searching for&#8211;as best I can
determine&#8211;function names that at some point changed but were not kept around as
aliases. This was particularly problematic when trying to run 24.3 on OS X
10.6.8.</p>

<p>In case anyone else runs into this problem, here&#8217;s my solution:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="c1">;; Require Common Lisp. (cl in &lt;=24.2, cl-lib in &gt;=24.3.)</span>
</span><span class='line'><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;cl-lib</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">progn</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;cl-block-wrapper</span> <span class="ss">&#39;identity</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;member*</span> <span class="ss">&#39;cl-member</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;adjoin</span> <span class="ss">&#39;cl-adjoin</span><span class="p">))</span>
</span><span class='line'>  <span class="c1">;; Else we&#39;re on an older version so require cl.</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;cl</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We try to require <code>cl-lib</code>, and when that succeeds, define some aliases so that
packages don&#8217;t complain about missing <code>cl-block-wrapper</code>, <code>member*</code>, and
<code>adjoin</code>. If it doesn&#8217;t succeed, we&#8217;re on an older Emacs, so require the old
<code>cl</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/juxtaposition/">Juxtaposition</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-16T19:02:00-04:00" pubdate data-updated="true">May 16<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A few days ago, I happened by chance to read these two articles one after the other:</p>

<ul>
<li><p><a href="http://tomayko.com/writings/unicorn-is-unix">I like Unicorn because it&#8217;s Unix</a></p></li>
<li><p><a href="http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html">The Secret To 10 Million Concurrent Connections -The Kernel Is The Problem, Not The Solution</a></p></li>
</ul>


<p>The first is about how good Unix is at scaling the scheduling and distribution
of work among processes. The second is about how Unix is the problem when it
comes to the scheduling and distribution of work at scale.</p>

<p>The question, of course, is &#8220;What scale?&#8221;. Like the difference between a cure and a
poison is sometimes the dosage.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/reprise-of-zero-to-node/">Zero to Node, Again</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-17T08:09:00-05:00" pubdate data-updated="true">Jan 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At <a href="http://www.meetup.com/node-dc/events/98796672/">NodeDC&#8217;s January meetup</a>,
I&#8217;ll be giving a reprise of my
<a href="http://sandinmyjoints.github.com/zero-to-node/">Zero to Node</a> talk, about
designing, coding, and launching my first web service using Node.js. The meetup
is Wednesday, Jan 23, at Stetson&#8217;s (1610 U St NW). Hope to see you there!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/review-of-requests-1-dot-0/">Review of Requests 1.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-14T17:22:00-05:00" pubdate data-updated="true">Jan 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Author&#8217;s note: This piece was <a href="http://thediagram.com/12_6/rev_reitz.html">originally published</a> in the excellent literary journal
 <a href="http://thediagram.com/">DIAGRAM</a>, Issue 12.6. I&#8217;m
 re-publishing here for formatting reasons.</em></p>

<p>Identification with another is addictive: some of my life&#8217;s most profound, memorable experiences have come when something bridged the gap between me and another human. Because I&#8217;m a reader, this can occur across the distance of space and time. It&#8217;s happened with minor Chekov characters, and at the end of Kate Mansfield stories. It happens again and again with Norman Rush and George Saunders. The author has pushed a character through the page and connected with me on a deep level: identification.</p>


<p>Identification happens with computer programming, too.</p>


<p>I say this as a reader, writer, and programmer: I experience identification when reading and programming, and I strive to create it when writing and programming.</p>


<p>Though they deal with the messiness of reality differently, several techniques common to both disciplines enable them to achieve this mental intimacy: navigating complexity; avoiding pitfalls that inhibit communication; choosing structure wisely; harnessing expressive power; and inhabiting other minds. The Requests library, a work of computer programming by Kenneth Reitz, illustrates this.</p>




</div>
  
  
    <footer>
      <a rel="full-article" href="/2013/01/review-of-requests-1-dot-0/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/11/update-and-rescheduling/">Update and Rescheduling</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-04T22:23:00-05:00" pubdate data-updated="true">Nov 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hurricane Sandy rescheduled
  <a href="http://www.meetup.com/Nova-Node/events/84918342/"><strong>Zero to Node</strong></a>, my talk
  about writing and deploying a node.js app in production, to Wednesday, November
  7. Hope to see you there!</p>

<p>  (Update: <a href="http://sandinmyjoints.github.com/zero-to-node">here are the slides from my talk</a>.)</p>

<p>  In other news, I&#8217;ve redone this site using <a href="http://octopress.org/">Octopress</a>
  with the <a href="https://github.com/roberto/oct2-orange">oct2-orange theme</a>. Sweet!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/a-case-study-of-node-js-in-production/">A Case Study of Node.js in Production</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-01T17:27:53-04:00" pubdate data-updated="true">Oct 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m giving a talk about my experience <a href="http://www.meetup.com/Nova-Node/events/84918342/">developing and deploying a Node.js web
service in production</a> at the
next Nova-Node meetup, October 30 at 6:30 p.m. Below is the writeup. If it
sounds interesting to you, come by!</p>

<blockquote><p>SpanishDict recently deployed a new text-to-speech service powered by
  Node. This service can generate audio files on the fly for arbitrary Spanish
  and English texts with rapid response times. The presentation will walk
  through the design, development, testing, monitoring, and deployment process
  for the new application. We will cover topics like how to structure an Express
  app, testing and debugging, learning to think in streams and pipes, writing a
  Chef cookbook to deploy to AWS, and monitoring the application for high
  performance. The lead engineer on the project, William Bert, will also talk
  about his experiences transitioning from a Python background to Node and some
  of the key insights he had about writing in Node while developing the
  application.</p></blockquote>

<p>Update: <a href="http://sandinmyjoints.github.com/zero-to-node">here are the slides from the talk</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/05/relatively-quick-and-easy-gensim-example-code/">(Relatively) Quick and Easy Gensim Example Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-04T04:12:23-04:00" pubdate data-updated="true">May 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here&#8217;s some sample code that shows the basic steps necessary to use gensim to create a corpus, train models (log entropy and latent semantic analysis), and perform semantic similarity comparisons and queries.</p>

<p><a href="http://radimrehurek.com/gensim/">gensim</a> has an excellent tutorial, and this does not replace reading and understanding it. Nonetheless, this may be helpful for those interested in doing some quick experimentation and getting their hands dirty fast. It takes you from training corpus to index and queries in about 100 lines of code, much of which is documentation.</p>

<p>Note that this code <strong>will not work out of the box</strong>. To train the models, you need to provide your own background corpus (a collection of documents, where a document can range from one sentence up to multiple pages of text). Choosing a good corpus is an art; generally, you want tens of thousands of documents that are representative of your problem domain. Like the gensim tutorial, this code also shows how to build a corpus from Wikipedia for experimentation, though note that doing so require a lot of computing time. You could potentially <a href="http://williamjohnbert.com/2012/03/how-to-install-accelerated-blas-into-a-python-virtualenv/">save hours by installing accelerated BLAS on your system</a>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2012/05/relatively-quick-and-easy-gensim-example-code/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/05/an-introduction-to-gensim-topic-modelling-for-humans/">An Introduction to Gensim: &#8220;Topic Modelling for Humans&#8221;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-03T10:06:02-04:00" pubdate data-updated="true">May 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>On Tuesday, I presented at the monthly DC Python meetup. My talk was an introduction to gensim, a free Python framework for topic modelling and semantic similarity using LSA/LSI and other statistical techniques. I&#8217;ve been using gensim on and off for several months at work, and I really appreciate its performance, clean API design, documentation, and community. (All of this is due to its creator, Radim Rehurek, who I interviewed recently.)</p>

<p>The presentation slides are <a href="http://www.slideshare.net/sandinmyjoints/an-introduction-to-gensim-topic-modelling-for-humans">available here</a>. I also wrote some <a href="http://williamjohnbert.com/2012/05/relatively-quick-and-easy-gensim-example-code/">quick gensim example code</a> that walks through creating a corpus, generating and transforming models, and using models to do semantic similarity. The code and slides are both also available on my <a href="https://github.com/sandinmyjoints/gensimtalk">github account</a>.</p>

<p>Finally, I also developed a <a href="http://github.com/sandinmyjoints/visularity">demo app to visualize semantic similarity queries</a>. It&#8217;s a Flask web app, with gensim generating data on the backend that is clustered by scipy and scikit-learn and visualized by d3.js as agglomerative and hierarchical clusters as well as a simple table and dendrogram. To make it all work in realtime, I used threading and hookbox. I call it Visularity, and it&#8217;s <a href="http://github.com/sandinmyjoints/visularity">available on github</a>. You need to provide your own model and dictionary data to use&#8211;check out my presentation and visit <a href="http://radimrehurek.com/gensim">radimrehurek.com/gensim/</a> to learn how. Comments and feedback welcome!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <ul id="recent_posts">
      <li class="post">
      <a href="http://williamjohnbert.com" alt="Home"><img src="/images/Home.png"></a>
      <a href="http://williamjohnbert.com/archives/" alt="Archives"><img src="/images/Calendar.png"></a>
      <a href="mailto:" alt="E-Mail"><img src="/images/Envelope.png"></a>
      <a href="http://williamjohnbert.com/atom.xml" alt="subscribe feed"><img src="/images/rss_big.png"></a>
      </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/09/why-chrome-sometimes-sends-the-same-post-multiple-times/">How legit HTTP (with an async io assist) massacred my Node workers</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/allow-cors-with-localhost-in-chrome/">Allow CORS with localhost in Chrome</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/emacs-cl-lib-madness/">Emacs cl-lib madness</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/juxtaposition/">Juxtaposition</a>
      </li>
    
      <li class="post">
        <a href="/2013/01/reprise-of-zero-to-node/">Zero to Node, Again</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sandinmyjoints">@sandinmyjoints</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sandinmyjoints',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - William John Bert -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wjb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
