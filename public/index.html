
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>William John Bert</title>
  <meta name="author" content="William John Bert">

  
  <meta name="description" content="I made nodegovernance.io &mdash; which encourages Node
users to express support for using io.js's open governance model as the basis
for the Node &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://williamjohnbert.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
   <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="William John Bert" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1913538-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">William John Bert</a></h1>
  
    <h2>Loves to write words and code.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:williamjohnbert.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/02/why-id-like-node-and-io-dot-js-to-merge/">Why I&#8217;d Like Node and io.js to Merge</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-17T18:46:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I made <a href="http://nodegovernance.io/">nodegovernance.io</a> &mdash; which encourages Node
users to express support for using io.js&#8217;s open governance model as the basis
for the Node foundation&#8217;s technical committee &mdash; because from where I sit,
one Node with a technical committee composed of the best technical people is the
ideal outcome of this situation.</p>

<p>My life would be easier if there were just one Node. My team wouldn&#8217;t have to
spend time discussing and deciding which to use. There wouldn&#8217;t be any confusion
in the future about whether <code>npm install</code> would give me a module I could use
with whatever runtime I happened to be using.</p>

<p>The
<a href="https://medium.com/@iojs/io-js-and-a-node-js-foundation-4e14699fb7be">recent Medium post</a>
said that io.js met with Joyent CEO Scott Hammond last week, so I&#8217;m sure he
knows exactly where they stand.</p>

<p>And the big companies that are already on the foundation board are certainly
going to get input into the rules for the technical committtee.</p>

<p>What about the rest of us &mdash; engineers who use Node / io.js every day but
aren&#8217;t inner core, who don&#8217;t work for an IBM or a PayPal, who want stability and
also language improvements that will make our jobs easier?</p>

<p>I hated the idea of looking back a few months from now, in the midst of heated
discussions about whether to use Node or io.js, with <span style="white-space:nowrap;"><code>npm install</code>s</span> failing all around me, and wondering if there was
anything I could have done to prevent this situation. A tweet doesn&#8217;t count for
all that much, but it&#8217;s more than nothing.</p>

<blockquote class="twitter-tweet" lang="en"><p><a href="https://twitter.com/williamjohnbert">@williamjohnbert</a> Thanks William. The TC will consider that when they define the governance model.</p>&mdash; Scott Hammond (@Scott_Hammond) <a href="https://twitter.com/Scott_Hammond/status/566045931657633792">February 13, 2015</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/04/handing-off-a-legacy-site/">Using Github Pages to Hand Off a Legacy Site and Make Everyone Happier</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-30T18:52:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here&#8217;s how I turned over maintenance of a legacy site &#8211; built as a one-off
project years ago using now outdated technology &#8211; to my non-techincal
cofounder, with only a few hours of work. Best of all, it now uses evergreen
technology that will make it easy for her to update for years to come, and
everyone is happy with the outcome.</p>

<h3>The problem</h3>

<p>I created <a href="http://www.callandresponsedc.org">Call and Response</a> when my friend
Kira and I decided to co-curate an art show of that name in 2010. It became an
annual event, and each year I updated the website with the new participants and
details. This year, Kira is continuing the show with support from others because
I&#8217;m out of capacity to help.</p>

<p>Kira needs to be be able to update the website. It lists what the concept behind
the show is; who&#8217;s participating; where the show is; when it opens; and more. I
created the original website using <a href="http://www.djangoproject.com">Django</a> as a
learning exercise when I was fairly new to web development. I went all out by my
standards of the time, creating a simple micro-CMS that helped me learn about
the MVC pattern, etc.</p>

<p>However, the project had no use outside of this particular website. It could not
be generalized without a significant overhaul, and I had no need to generalize
it. In fact, I had no interest in maintaining it or even working with it. I
built it with Django 1.3, and hosted it with a service that I don&#8217;t use anymore.</p>

<p>Usually, in such a case, it&#8217;s tough luck for the the web developer. Kira is not
a web developer and has no interest in becoming one; she just wants to be able
to update her website. The responsible thing is to step up to to the task, and
keep the site going.</p>

<p>This time I had an idea for how to reach the end goal of the site being updated
in a timely way yet still ditching the legacy code. I thought I saw a path
forward to handing it off to her in a way that would let her easily edit text,
links, and images, and create new pages.</p>

<h3>The solution</h3>

<p>Here&#8217;s how I converted the site from a Django project that only someone who knew
Python could update into a flat site that anyone could edit by knowing only the
most basic HTML:</p>

<p>\1. Scrape.</p>

<p>  This seemed like something I could do fairly easily with my current web
  programming tool of choice &#8211; Node.js. I just had too download and write to disk
  every page I could find by following links that had the same host. But often
  with things that seem straightforward, the devil&#8217;s often in the details, and
  anyway, I figured someone else must have wanted to do this, so there had to be a
  tool for it, which would turn this from fairly easily into dead simple.</p>

<p>  The tool I found is called <a href="http://www.httrack.com/">HTTrack</a>.</p>

<pre><code>$ brew install httrack
</code></pre>

<p>  I ran it against <a href="http://www.callandresponsedc.org">Call and Response</a>,
  selecting all the default options.</p>

<pre><code>$ httrack "www.callandresponsedc.org" -v
</code></pre>

<p>  Lo and behold, it did exactly what I wanted. Now I had a full static version of
  the site.</p>

<p>\2. Host.</p>

<p>I needed to host this static site somewhere free, reliable, and easy to use. I
created a Github organization, initialized a git repo, created a branch named
<code>gh-pages</code>, and pushed it to Github. Now the site was up at
<code>callandresponsedc.github.io/callandresponsedc</code>, (albeit in a broken form due to
the static assets&#8217; root-relative paths resulting in 404s).</p>

<p>Then I added a
<a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages">CNAME</a>
for callandresponsedc.org, and I switched the DNS from my old hosting provider
to the name service, and added the
<a href="http://davidensinger.com/2013/03/setting-the-dns-for-github-pages-on-namecheap/">right DNS entries</a></p>

<p>Once the DNS changes took effect, the new static site was up where it needed to
be: http://callandresponsedc.org. And it looked <em>exactly</em> as it had before: to
any visitor who saw it before the change and again after, no difference would
have been apparent.</p>

<p>\3. Enable.</p>

<p>While I&#8217;d waited for the DNS to change, I&#8217;d asked Kira to create a github account,
added her to the organization, and spent 15 minutes writing up a brief guide to
how to edit the HTML pages using Github.</p>

<p>Thanks to
<a href="https://github.com/blog/905-edit-like-an-ace">github&#8217;s editing tools</a>, she now
had the ability to make changes that would take effect instantly.</p>

<p>Technically, at this point, I was no longer needed. I could have handed it over
now. Kira was enabled to do everything she needed to do. But I would have had to
add a caveat: &#8220;By the way, when you want to change anything in the menu, or
header, or footer, or to add a new logo or change colors, you have to do it on
<em>every single page</em>.&#8221;</p>

<p>Because Httrack, good as it is, is not good enough to produce DRY results. Each
page of the static site repeated all the same HTML structure for its header and
footer and body, and contained its own set of inline styles. Changing any part
of that would have meant changing every page. There weren&#8217;t a lot pages, but
nonetheless, I didn&#8217;t want to force that burden on K.</p>

<p>I could do better.</p>

<p>\4. Refactor.</p>

<p>Large parts of the pages were identical, so I could factor them out into
includes, and make a couple of simple layout templates composed of these. Same
idea with the stylesheet.</p>

<p>To make this work, I had to use something slightly more complicated than flat
HTML files. I decided to convert the site to use
<a href="https://help.github.com/articles/using-jekyll-with-pages">(Github-flavored) Jekyll</a>.
I won&#8217;t repeat the instructions needed to get that up and running; just follow
the link, and do what it says. It takes on the order of a few minutes.</p>

<p>To refactor, I just needed to figure out exactly what was common to all pages,
hack it out into includes, and reassemble the includes as templates. Then I&#8217;d
specify which template to use via YAML front-matter on each page, and voila, my
Jekyll site would be done. Because I use
<a href="http://www.gnu.org/software/emacs/">Emacs</a>, I used
<a href="http://www.gnu.org/software/emacs/manual/html_mono/ediff.html">ediff</a>, but you
could do this with any diffing tool and text editor.</p>

<p>A nice side effect of this was that the pages that Kira would be editing got much
simple. They went from something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>About - Call + Response
</span><span class='line'>  <span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://platform.twitter.com/anywhere.js?id=IrVoVLmkJDVw9Pagwdxsow&amp;amp;v=1&quot;</span>
</span><span class='line'>          <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;Call + Response is an art show in Washington, DC, pairing writers and artists.&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;William John Bert&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/static/fonts/fonts.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/static/css/bootstrap.css&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/static/css/bootstrap-responsive.css&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/static/css/style.css&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;fb-root&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;script&gt;</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://connect.facebook.net/en_US/all.js#xfbml=1&amp;appId=398123750217250&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'><span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook-jssdk&#39;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>Call + Response
</span><span class='line'>      <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span3&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;well sidebar-nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav nav-list&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/about&quot;</span><span class="nt">&gt;</span>About
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/opening&quot;</span><span class="nt">&gt;</span>Opening
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/participants&quot;</span><span class="nt">&gt;</span>Participants
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/sponsors&quot;</span><span class="nt">&gt;</span>Sponsors
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/contact&quot;</span><span class="nt">&gt;</span>Contact
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/press&quot;</span><span class="nt">&gt;</span>Press
</span><span class='line'>        <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span9&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;chiclet pull-right visible-desktop&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://twitter.com/share&quot;</span> <span class="na">class=</span><span class="s">&quot;twitter-share-button&quot;</span> <span class="na">data-count=</span><span class="s">&quot;none&quot;</span>
</span><span class='line'>     <span class="na">data-hashtags=</span><span class="s">&quot;callandresponsedc&quot;</span><span class="nt">&gt;</span>Tweet
</span><span class='line'>  <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script&gt;</span><span class="o">!</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">js</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">js</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">js</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;http://platform.twitter.com/widgets.js&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">fjs</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">}(</span><span class="nb">document</span><span class="p">,</span> <span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;twitter-wjs&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;chiclet pull-right visible-desktop&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fb-like&quot;</span> <span class="na">data-send=</span><span class="s">&quot;true&quot;</span> <span class="na">data-width=</span><span class="s">&quot;100&quot;</span>
</span><span class='line'>       <span class="na">data-show-faces=</span><span class="s">&quot;false&quot;</span> <span class="na">data-colorscheme=</span><span class="s">light</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;swappable-content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;h1&gt;</span>About
</span><span class='line'><span class="nt">&lt;/h1&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span><span class='line'>  Call + Response is an (almost) annual art show in the nation&#39;s capital that brings together writers and visual artists. The writers provide the call with an original piece of writing and then visual artists generate a new piece of work in response. The end result being two pieces that resonate with each other.
</span><span class='line'>  [etc...]
</span></code></pre></td></tr></table></div></figure>


<p>to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>---
</span><span class='line'>layout: page
</span><span class='line'>title: About
</span><span class='line'>---
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;h1&gt;</span>About
</span><span class='line'><span class="nt">&lt;/h1&gt;</span>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span><span class='line'>  Call + Response is an (almost) annual art show in the nation&#39;s capital that brings together writers and visual artists. The writers provide the call with an original piece of writing and then visual artists generate a new piece of work in response. The end result being two pieces that resonate with each other.
</span><span class='line'><span class="nt">&lt;/p&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It took an hour or so to DRY out everything, and then&#8230;I was done. A site that
had been a mess &#8211; one-off code written years ago for an outdated version of a
framework that I don&#8217;t use anymore &#8211; had become so simple that I could hand it
off to my non-technical cofounder and both of us would be happier for it!</p>

<p>And sure enough, since then, Kira has made numerous updates to the site, each of
which would have taken at least one, maybe a couple, rounds of emails back and
forth, plus a context switch for me to make the changes, and a deploy, another
round of emails to confirm that everything now looked good. Repeat, repeat,
repeat.</p>

<p>I did this with a Django site, but it&#8217;d be just as applicable with a lot of
Wordpress sites, or any CMS, really. Obviously, there are many cases where this
solution wouldn&#8217;t work for a variety of reasons. But if you can make it work,
it&#8217;s a joy to do so!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/using-a-node-repl-with-emacs/">Using a Node Repl in Emacs With Nvm and Npm</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-17T16:37:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Running a repl inside Emacs is often convenient for evaluating code, checking
syntax, and myriad other tasks. When I wanted to run a Node REPL, I found that I
needed to do a little set up to get everything working the way I wanted.</p>

<p>My first question was: which Node? With
<a href="https://github.com/creationix/nvm">nvm</a>, I&#8217;ve installed multiple version on my
machine. So I needed a way to specify one to execute.</p>

<p>Another question was: where to run Node? Since <a href="https://www.npmjs.org/">npm</a>
looks inside <code>node_modules</code> directories starting with the current directory and
working up the file system hierarchy, the current working directory is
important. If I want access to the npm modules installed for project A, I need
to start my repl&#8217;s Node process from <code>path/to/projectA</code>.</p>

<p>But that raises another question: what happens when I want to switch to project
B? Do I need to use <code>process.chdir()</code> to switch the Node repl&#8217;s current working
directory to <code>path/to/projectB</code>? That&#8217;s clumsy and annoying.</p>

<p>Here&#8217;s how I answered these questions:</p>

<p><a href="https://github.com/rejeep/nvm.el">nvm.el</a> gives you <code>nvm-use</code> to activate a
   version of Node within Emacs. It&#8217;s basically a nice wrapper around setting
   the enviroment variables <code>NVM_BIN</code> and <code>NVM_PATH</code> and adding the path to the
   Node version you want to use to your <code>PATH</code>. Great!</p>

<p>Except for one problem: <code>nvm-use</code> isn&#8217;t interactive. It&#8217;s meant to be use
programmatically. So I needed to write a small <code>do-nvm-use</code> wrapper that lets me
specify a version and then activate it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='common-lisp'><span class='line'><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;nvm</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">do-nvm-use</span> <span class="p">(</span><span class="nv">version</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">interactive</span> <span class="s">&quot;sVersion: &quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">nvm-use</span> <span class="nv">version</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">exec-path-from-shell-copy-env</span> <span class="s">&quot;PATH&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>To specify where to run Node, I wrote another small defun, named <code>run-node</code>,
that prompts for a directory in which to start Node. Before it does this,
though, it checks whether a program named <code>node</code> is in the <code>exec-path</code>, and if
not, it runs <code>do-nvm-use</code> first. Once we have a Node to execute and a directory
to execute it in, we can make a new <code>comint</code> buffer bound to the repl process.</p>

<p>To address the issue of different repls needing to be run for different
projects, <code>run-node</code> adds the cwd to the buffer name. Repls for project A and
project B will live in buffers named <code>*-node-repl-path/to/projectA</code> and
<code>*-node-repl-path/to/projectB</code>, respectively&mdash;making switching to the right
buffer with <a href="http://www.emacswiki.org/emacs/InteractivelyDoThings">ido</a> trivial.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='common-lisp'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">run-node</span> <span class="p">(</span><span class="nv">cwd</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">interactive</span> <span class="s">&quot;DDirectory: &quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&quot;node&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">call-interactively</span> <span class="ss">&#39;do-nvm-use</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">default-directory</span> <span class="nv">cwd</span><span class="p">))</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">pop-to-buffer</span> <span class="p">(</span><span class="nv">make-comint</span> <span class="p">(</span><span class="nb">format</span> <span class="s">&quot;node-repl-%s&quot;</span> <span class="nv">cwd</span><span class="p">)</span> <span class="s">&quot;node&quot;</span> <span class="no">nil</span> <span class="s">&quot;--interactive&quot;</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now to start my Node repls, I just call <code>run-node</code> and I&#8217;m all set!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/towards-100-percent-uptime-with-node/">Towards 100% Uptime With Node</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-17T16:18:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In December, I gave a talk at
<a href="http://www.meetup.com/Nova-Node/events/154016332/">Nova Node</a> called
<a href="http://sandinmyjoints.github.io/towards-100-pct-uptime/">&#8220;Towards 100% Uptime with Node.js&#8221;</a>.
I wrote an accompanying blog post for the
<a href="http://engineering.fluencia.com">Fluencia / SpanishDict engineering blog</a>:
<a href="http://engineering.spanishdict.com/blog/2013/12/20/the-4-keys-to-100-uptime-with-nodejs">The 4 Keys to 100% Uptime with Node.js</a>.</p>

<p>Hopefully these resources will be useful for other Node engineers out
there&mdash;they have helped us have confidence that downtime is not a problem
for our users.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/09/why-chrome-sometimes-sends-the-same-post-multiple-times/">How Legit HTTP (With an Async Io Assist) Massacred My Node Workers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-10T18:55:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>An uncaught exception in our Node app was causing not only one, but two and then
three workers to die. (Fortunately, we hardly ever encounter uncaught
exceptions. Really, just this one since launch a few months ago. We&#8217;re Node
studs! Right?)</p>

<p>The funny thing is that we&#8217;re using Express, which (via Connect) wraps each
request / response in a try / catch. And we use Express&#8217;s error handler, which
returns 500 on unhandled errors.</p>

<p>Another funny thing is we use cluster, which isolates workers from each other.
They live in separate, solipsistic processes.</p>

<p>But instead of returning 500, our worker simply died. And, as if in sympathy,
the rest immediately followed.</p>

<p>Time to get to the bottom of this. A Node stud like me can figure it out. No
sweat. Right?</p>

<p>For a sanity check, I went to Chrome and Firefox&#8217;s network inspectors. Only one
POST, the bad request that triggered the exception. Everything else looks
normal. Sanity: verified.</p>

<p>Then it was on to the
<a href="http://nodejs.org/docs/latest/api/cluster.html#cluster_how_it_works">cluster module</a>.
That magical &#8220;OS load balancing&#8221; seemed highly suspicious. But nope, I asked in
#nodejs and they said that only applies at the TCP connection level. Once a
connection is assigned to a worker, it never goes to another worker. Meaning
that the bad request was isolated&mdash;only the worker who received the initial
connection could encounter it.</p>

<p>But the workers kept on dying.</p>

<p>These workers morted out fast. They didn&#8217;t even return 500, or any kind of
response. The more I thought about it, that didn&#8217;t really seem right. Not right
at all. Why no 500?</p>

<p>But I can only tackle one mystery at a time. I wanted to understand: why did so
many workers die?</p>

<p>Furious googling ensued. My efforts were rewarded with this nugget:</p>

<blockquote><p>If an HTTP/1.1 client sends a request which includes a request body, but which
does not include an Expect request-header field with the “100-continue”
expectation, and if the client is not directly connected to an HTTP/1.1 origin
server, and if the client sees the connection close before receiving any status
from the server, the client SHOULD retry the request.</p></blockquote>

<p><small>(From the
<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.4">HTTP 1.1 spec, RFC 2616</a>.
<a href="http://stackoverflow.com/a/14345476/599258">Original hat tip</a>, which links to
this
<a href="http://geek.starbean.net/?p=393">informative post about double HTTP requests</a>.)</small></p>

<p>My mind was somewhat blown. The browers were right after all. They were just
following HTTP. And&mdash;helpfully!&mdash;hiding the resent POSTs from the network
inspector.</p>

<p>But POSTs are dangerous. They mutate resources! I must only click the <em>Order</em>
button once or I may get charged multiple times!</p>

<p>I had a thought. One I have often, yet each time, it seems new again: <em>I have
much to learn</em>.</p>

<p>Back to the 500s. Or lack thereof. Which got funnier still when I realized that
other errors in our controllers that threw exceptions <em>did</em> return 500s. Being a
hands-on kind of guy, I added one right at the top of a route controller: <code>throw
new Error("uh-oh")</code>. My dev server spat back: <code>500 Error: uh-oh</code>.</p>

<p>So why did that one particular error never, ever return a 500, or any response
of any kind?</p>

<p>It&#8217;s my fault, really. I&#8217;m still a Node newbie (I must never forget this). I had
missed that because async IO callbacks occur in a different call stack from the
request / response cyle, one that originates from the event loop,
<a href="http://stackoverflow.com/questions/13228649/unable-to-handle-exception-with-node-js-domains-using-express/13240256#13240256">Express&#8217;s try / catch doesn&#8217;t catch them</a>.</p>

<p>It makes total sense. I have much to learn.</p>

<p>So what to do? <code>require('domain')</code> to the rescue. I can write some middleware (a
bit of <a href="https://github.com/brianc/node-domain-middleware">this</a>, a dash of
<a href="https://github.com/mathrawka/express-domain-errors">that</a>) to wrap the request
/ response in a domain.</p>

<p>But how do I get this domain into my controller? My solution was to attach it to
<code>res.locals._domain</code>. Good solution? I don&#8217;t know. I suspect there&#8217;s a better
way. Good enough? It solved my immediate problem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Model</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span> <span class="nx">value</span><span class="p">},</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">_domain</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// This callback can throw all it wants. My domain will catch it.</span>
</span><span class='line'><span class="p">}));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sweet. Now, armed with a reference to <code>res</code> in the domain error handler, I can
return a 500. Voila, the browser gets its response. No more helpful resent
POSTs. The silent gratitude of the spared workers is its own reward.</p>

<p>Except, do I need to bind every
<a href="https://github.com/LearnBoost/mongoose/pull/1337">mongoose</a> and
<a href="https://github.com/joyent/node/issues/3908">other kind of async IO operation</a>
in my app? There are many.</p>

<p>Many.</p>

<p>I have much to learn.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/allow-cors-with-localhost-in-chrome/">Allow CORS With Localhost in Chrome</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-25T19:04:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I spent some time wrestling with the notorious
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Same_origin_policy_for_JavaScript">same origin policy</a>
in order to get CORS
(<a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS">cross-origin resource sharing</a>)
working in Chrome for development work I was doing between two applications
running on localhost. Setting the <code>Access-Control-Allow-Origin</code> header to <code>*</code>
seemed to have no effect, and
<a href="https://code.google.com/p/chromium/issues/detail?id=67743">this bug report</a>
nearly led me to believe that was due to a bug in Chrome that made CORS with
localhost impossible. It&#8217;s not. It turned out that I also needed some other
CORs-related headers: <code>Access-Control-Allow-Headers</code> and
<code>Access-Control-Allow-Methods</code>.</p>

<p>This (slightly generalized) snippet of <a href="http://expressjs.com">Express.js</a>
middleware is what ended up working for me:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/api/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span> <span class="s2">&quot;Cache-Control, Pragma, Origin, Authorization, Content-Type, X-Requested-With&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">,</span> <span class="s2">&quot;GET, PUT, POST&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that, Chrome started making OPTIONS requests when I wanted to POST from
localhost:3001 to localhost:2002. It seems that using <code>contentType:
application/json</code> for POSTs forces CORS preflighting, which surprised me since
it seems like a common case for APIs, but no matter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;/api/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="s2">&quot;options&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">204</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/emacs-cl-lib-madness/">Emacs Cl-lib Madness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-27T15:52:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Emacs 24.3 renamed the Common Lisp emulation package from <code>cl</code> to <code>cl-lib</code>. The
<a href="http://www.gnu.org/software/emacs/NEWS.24.3">release notes</a> say that <code>cl</code> in
24.3 is now &#8220;a bunch of aliases that provide the old, non-prefixed names&#8221;, but I
encountered some problems with certain packages searching for&#8211;as best I can
determine&#8211;function names that at some point changed but were not kept around as
aliases. This was particularly problematic when trying to run 24.3 on OS X
10.6.8.</p>

<p>In case anyone else runs into this problem, here&#8217;s my solution:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scheme'><span class='line'><span class="c1">;; Require Common Lisp. (cl in &lt;=24.2, cl-lib in &gt;=24.3.)</span>
</span><span class='line'><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;cl-lib</span> <span class="nv">nil</span> <span class="nv">t</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">progn</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;cl-block-wrapper</span> <span class="ss">&#39;identity</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;member*</span> <span class="ss">&#39;cl-member</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">defalias</span> <span class="ss">&#39;adjoin</span> <span class="ss">&#39;cl-adjoin</span><span class="p">))</span>
</span><span class='line'>  <span class="c1">;; Else we&#39;re on an older version so require cl.</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">require</span> <span class="ss">&#39;cl</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We try to require <code>cl-lib</code>, and when that succeeds, define some aliases so that
packages don&#8217;t complain about missing <code>cl-block-wrapper</code>, <code>member*</code>, and
<code>adjoin</code>. If it doesn&#8217;t succeed, we&#8217;re on an older Emacs, so require the old
<code>cl</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/juxtaposition/">Juxtaposition</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-16T19:02:00-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A few days ago, I happened by chance to read these two articles one after the other:</p>

<ul>
<li><p><a href="http://tomayko.com/writings/unicorn-is-unix">I like Unicorn because it&#8217;s Unix</a></p></li>
<li><p><a href="http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html">The Secret To 10 Million Concurrent Connections -The Kernel Is The Problem, Not The Solution</a></p></li>
</ul>


<p>The first is about how good Unix is at scaling the scheduling and distribution
of work among processes. The second is about how Unix is the problem when it
comes to the scheduling and distribution of work at scale.</p>

<p>The question, of course, is &#8220;What scale?&#8221;. Like the difference between a cure and a
poison is sometimes the dosage.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/reprise-of-zero-to-node/">Zero to Node, Again</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-17T08:09:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At <a href="http://www.meetup.com/node-dc/events/98796672/">NodeDC&#8217;s January meetup</a>,
I&#8217;ll be giving a reprise of my
<a href="http://sandinmyjoints.github.com/zero-to-node/">Zero to Node</a> talk, about
designing, coding, and launching my first web service using Node.js. The meetup
is Wednesday, Jan 23, at Stetson&#8217;s (1610 U St NW). Hope to see you there!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/review-of-requests-1-dot-0/">Review of Requests 1.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-14T17:22:00-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Author&#8217;s note: This piece was <a href="http://thediagram.com/12_6/rev_reitz.html">originally published</a> in the excellent literary journal
 <a href="http://thediagram.com/">DIAGRAM</a>, Issue 12.6. I&#8217;m
 re-publishing here for formatting reasons.</em></p>

<p>Identification with another is addictive: some of my life&#8217;s most profound, memorable experiences have come when something bridged the gap between me and another human. Because I&#8217;m a reader, this can occur across the distance of space and time. It&#8217;s happened with minor Chekov characters, and at the end of Kate Mansfield stories. It happens again and again with Norman Rush and George Saunders. The author has pushed a character through the page and connected with me on a deep level: identification.</p>


<p>Identification happens with computer programming, too.</p>


<p>I say this as a reader, writer, and programmer: I experience identification when reading and programming, and I strive to create it when writing and programming.</p>


<p>Though they deal with the messiness of reality differently, several techniques common to both disciplines enable them to achieve this mental intimacy: navigating complexity; avoiding pitfalls that inhibit communication; choosing structure wisely; harnessing expressive power; and inhabiting other minds. The Requests library, a work of computer programming by Kenneth Reitz, illustrates this.</p>




</div>
  
  
    <footer>
      <a rel="full-article" href="/2013/01/review-of-requests-1-dot-0/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="page2">&larr; Older</a>
    
    <a href="archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <ul id="recent_posts">
      <li class="post">
      <a href="http://williamjohnbert.com" alt="Home"><img src="/images/Home.png"></a>
      <a href="http://williamjohnbert.com/archives/" alt="Archives"><img src="/images/Calendar.png"></a>
      <a href="mailto:" alt="E-Mail"><img src="/images/Envelope.png"></a>
      <a href="http://williamjohnbert.com/atom.xml" alt="subscribe feed"><img src="/images/rss_big.png"></a>
      </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/02/why-id-like-node-and-io-dot-js-to-merge/">Why I&#8217;d like Node and io.js to merge</a>
      </li>
    
      <li class="post">
        <a href="/2014/04/handing-off-a-legacy-site/">Using Github Pages to hand off a legacy site and make everyone happier</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/using-a-node-repl-with-emacs/">Using a Node repl in Emacs with nvm and npm</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/towards-100-percent-uptime-with-node/">Towards 100% Uptime with Node</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/why-chrome-sometimes-sends-the-same-post-multiple-times/">How legit HTTP (with an async io assist) massacred my Node workers</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sandinmyjoints">@sandinmyjoints</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sandinmyjoints',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - William John Bert -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wjb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
