<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Projects | William John Bert]]></title>
  <link href="http://williamjohbnert.com/categories/projects/atom.xml" rel="self"/>
  <link href="http://williamjohbnert.com/"/>
  <updated>2012-11-04T16:21:19-05:00</updated>
  <id>http://williamjohbnert.com/</id>
  <author>
    <name><![CDATA[William John Bert]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[django-social-auth: Installing and troubleshooting]]></title>
    <link href="http://williamjohbnert.com/2011/08/django-social-auth-installing-and-troubleshooting/"/>
    <updated>2011-08-26T07:16:14-04:00</updated>
    <id>http://williamjohbnert.com/2011/08/django-social-auth-installing-and-troubleshooting</id>
    <content type="html"><![CDATA[<p>Thanks to <code>django-registration</code>, I was able to build a working account registration/login system pretty easily. But I wanted to give users the ability to use their existing accounts through popular services such as Facebook, Twitter, etc., rather than have to create yet another account. Here's how I did it.</p>

<h1>Sorting Through the Choices</h1>

<p>There are a number of reusable Django apps out there to help with registration/login from social media sites. I found this <a href="http://hackerluddite.wordpress.com/2011/05/17/review-of-4-django-social-auth-apps/">Review of 4 Django Social Auth apps</a> very helpful in sorting out the options. After reading it, I was left to choose between <a href="https://github.com/omab/django-social-auth"><code>django-social-auth</code></a> (I originally linked to the wrong app here, but this link is correct) and <a href="https://github.com/pennersr/django-allauth"><code>django-allauth</code></a>. In the end, I went with <code>django-social-auth</code> (not to be confused with <code>django-socialauth</code>) because a friend had recommended it and because I'd already installed it before I read this article. However, the article's conclusion that <code>django-allauth</code> is best out of the box also seems valid.</p>

<h1>Installation</h1>

<p>The instructions in <a href="http://django-social-auth.readthedocs.org/en/latest/"><code>django-social-auth</code>'s docs</a> are helpful in walking you through available settings and options.</p>

<p>I also found the included example app useful. To use this app, I cloned <code>django-social-auth</code>'s git repo, created a virtualenv called <code>django-social-auth</code>, ran <code>pip install -r requirements.txt</code> inside this virtualenv to install all the required apps, ran <code>manage.py syncdb</code>, and finally ran <code>manage.py runserver</code>. Voila, example app is up and running at 127.0.0.1, showing a simple screen with options to login through about a dozen different different services.</p>

<h1>API Keys</h1>

<p>The first service I tested was Twitter. I use it more than any others, and I already had the API keys for it. I threw my API key and secret key into the example <code>local_settings.py</code> file provided with <code>django-social-auth</code> and tried to log in via the example app. Boom: <code>401 Unauthorized</code>. I double-checked all my settings and installation and whatnot. Seemed fine.</p>

<p>I turned my attention to the API keys. The ones I had were generated for <a href="http://www.readsrs.com">Readsr</a>, i.e., I entered readsrs.com as the domain when I generated them at dev.twitter.com. But now I was running on localhost, 127.0.0.1, so I suspected the readsrs.com keys wouldn't be valid. I wasn't sure whether Twitter would hand over a new consumer key for 127.0.0.1, or baulk at the request. (It seemed like it should do so, but I hadn't seen any instructions anywhere that said to get a key for your development machine.) Turns out Twitter will happily give you a key for 127.0.0.1. Once I plugged the new keys in, I was able to log in with my Twitter credentials, and just as it should, <code>django-social-auth</code> automatically created an <code>auth.user</code> for this account.</p>

<h1>Integrating with Readsr</h1>

<p>I followed the instructions again to config my own app, Readsr. To add a login option using Twitter credentials, I put a link to the reversed view that begins the <code>django-social-auth</code> login process for twitter, i.e., <code>{% url socialauth_begin "twitter" %}</code>, to my login template. And it worked.</p>

<p>I still need to fix a few oddities. For example, Twitter returns my first and last names together in <code>first_name</code> (or else <code>django-social-auth</code> is concatenating them into that column), and doesn't supply any email address. But the basic functionality is there, and was relatively easy to achieve.</p>

<h1>Postscript</h1>

<p>The author of the article I linked above had an error using OpenID when using <code>django-social-auth</code>, which is why he preferred <code>django-authall</code>. He filed a bug for the error he got, and I notice that <a href="https://github.com/omab/django-social-auth/issues/67">it was closed</a> 15 hours ago (though if you read the comments, it seems it was actually fixed back in mid-July). Good timing.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Simple Django Event Calendar]]></title>
    <link href="http://williamjohbnert.com/2011/06/django-event-calendar-for-a-django-beginner/"/>
    <updated>2011-06-13T16:34:52-04:00</updated>
    <id>http://williamjohbnert.com/2011/06/django-event-calendar-for-a-django-beginner</id>
    <content type="html"><![CDATA[<h3>Background</h3>

<p>I've been teaching myself Django by writing a web app that tracks reading series in cities: <a href="http://www.readsrs.com">Readsr</a>. A reading series is a kind of recurring event. It defines a time, location, and recurrence rule such as first Monday of the month. Writing a list view to display upcoming readings was easy, but I also wanted to create a calendar view, similar to what Google Calendar provides. That took a little more work.</p>

<h3>Existing Solutions</h3>

<p>First I searched for existing Django calendar solutions. I found several. <a href="https://code.google.com/p/django-swingtime/">Swingtime</a> and <a href="https://github.com/dokterbob/django-agenda">django-agenda</a> seemed very well thought out and comprehensive, but were also perhaps overkill for what I needed. <a href="https://code.google.com/p/django-gencal/">django-gencal</a> doesn't appear to be maintained and I had trouble understanding the documentation (though you may have better results, as I am slow).</p>

<h3>A Way Forward</h3>

<p>I found that Python's calendar module has a built template called <a href="http://docs.python.org/library/calendar.html#calendar.HTMLCalendar">HTMLCalendar</a>, which sounded promising. Then I found a <a href="http://journal.uggedal.com/creating-a-flexible-monthly-calendar-in-django/">couple</a> <a href="http://drumcoder.co.uk/blog/2010/jun/13/monthly-calendar-django/">examples</a> of people inheriting from HTMLCalendar to add data to the calendar display. This sounded right on, so I adapted this code for my reading events.</p>

<h3>Problem: Presentation and Content Mixed</h3>

<p>I noticed a problem in the code I was adapting. The view was producing HTML. That seemed to violate separation of content and presentation. Shouldn't the HTML be generated in the template? And since the templating language itself isn't powerful enough to generate an HTML table from a list of objects, that meant I needed to write my own template tag. Yikes.</p>

<h3>Writing My First Template Tag</h3>

<p>Django's documentation made it easy, though. A template tag consists of a few parts. Below is the code; it goes into a subdirectory of the django app called "templatetags."</p>

<p>The first part follows directly from the Django docs: get a register object.</p>

<p>Then I define a function to parse the template tag arguments and return the node (the HTML code from which the page is eventually build). The template syntax is defined here.</p>

<p>Then I define the node itself, which is made thread-safe by storing and retrieving the variables passed through the template tag from a context (again, this is straight from the Django docs).</p>

<p>Then I inherit from HTMLCalendar and redefine the format methods to add the particular reading event data. You could adapt this class to any kind of event that has an associated date/time by changing the groupby lambda function to use whatever field your event object uses to store its date and time (my reading object simply calls it "date_and_time").</p>

<p>Finally, I register this template tag so it is available to templates.</p>

<p>Here's the code.</p>

<pre><code>    from calendar import HTMLCalendar
    from django import template
    from datetime import date
    from itertools import groupby

    from django.utils.html import conditional_escape as esc

    register = template.Library()

    def do_reading_calendar(parser, token):
        """
        The template tag's syntax is {% reading_calendar year month reading_list %}
        """

        try:
            tag_name, year, month, reading_list = token.split_contents()
        except ValueError:
            raise template.TemplateSyntaxError, "%r tag requires three arguments" % token.contents.split()[0]
        return ReadingCalendarNode(year, month, reading_list)


    class ReadingCalendarNode(template.Node):
        """
        Process a particular node in the template. Fail silently.
        """

        def __init__(self, year, month, reading_list):
            try:
                self.year = template.Variable(year)
                self.month = template.Variable(month)
                self.reading_list = template.Variable(reading_list)
            except ValueError:
                raise template.TemplateSyntaxError

        def render(self, context):
            try:
                # Get the variables from the context so the method is thread-safe.
                my_reading_list = self.reading_list.resolve(context)
                my_year = self.year.resolve(context)
                my_month = self.month.resolve(context)
                cal = ReadingCalendar(my_reading_list)
                return cal.formatmonth(int(my_year), int(my_month))
            except ValueError:
                return          
            except template.VariableDoesNotExist:
                return


    class ReadingCalendar(HTMLCalendar):
        """
        Overload Python's calendar.HTMLCalendar to add the appropriate reading events to
        each day's table cell.
        """

        def __init__(self, readings):
            super(ReadingCalendar, self).__init__()
            self.readings = self.group_by_day(readings)

        def formatday(self, day, weekday):
            if day != 0:
                cssclass = self.cssclasses[weekday]
                if date.today() == date(self.year, self.month, day):
                    cssclass += ' today'
                if day in self.readings:
                    cssclass += ' filled'
                    body = ['&lt;ul&gt;']
                    for reading in self.readings[day]:
                        body.append('&lt;li&gt;')
                        body.append('&lt;a href="%s"&gt;' % reading.get_absolute_url())
                        body.append(esc(reading.series.primary_name))
                        body.append('&lt;/a&gt;&lt;/li&gt;')
                    body.append('&lt;/ul&gt;')
                    return self.day_cell(cssclass, '&lt;span class="dayNumber"&gt;%d&lt;/span&gt; %s' % (day, ''.join(body)))
                return self.day_cell(cssclass, '&lt;span class="dayNumberNoReadings"&gt;%d&lt;/span&gt;' % (day))
            return self.day_cell('noday', '&amp;nbsp;')

        def formatmonth(self, year, month):
            self.year, self.month = year, month
            return super(ReadingCalendar, self).formatmonth(year, month)

        def group_by_day(self, readings):
            field = lambda reading: reading.date_and_time.day
            return dict(
                [(day, list(items)) for day, items in groupby(readings, field)]
            )

        def day_cell(self, cssclass, body):
            return '&lt;td class="%s"&gt;%s&lt;/td&gt;' % (cssclass, body)

    # Register the template tag so it is available to templates
    register.tag("reading_calendar", do_reading_calendar)
</code></pre>

<p>Then, here's the view (and a couple helper functions) that gets called with the arguments from the URL, including the year, month, and series to display events for.</p>

<pre><code>    def named_month(month_number):

        """
        Return the name of the month, given the number.
        """
        return date(1900, month_number, 1).strftime("%B")

    def this_month(request):
        """
        Show calendar of readings this month.
        """
        today = datetime.now()
        return calendar(request, today.year, today.month)


    def calendar(request, year, month, series_id=None):
        """
        Show calendar of readings for a given month of a given year.
        ``series_id``
        The reading series to show. None shows all reading series.
        """

        my_year = int(year)
        my_month = int(month)
        my_calendar_from_month = datetime(my_year, my_month, 1)
        my_calendar_to_month = datetime(my_year, my_month, monthrange(my_year, my_month)[1])

        my_reading_events = Reading.objects.filter(date_and_time__gte=my_calendar_from_month).filter(date_and_time__lte=my_calendar_to_month)
        if series_id:
            my_reading_events = my_reading_events.filter(series=series_id)

        # Calculate values for the calendar controls. 1-indexed (Jan = 1)
        my_previous_year = my_year
        my_previous_month = my_month - 1
        if my_previous_month == 0:
            my_previous_year = my_year - 1
            my_previous_month = 12
        my_next_year = my_year
        my_next_month = my_month + 1
        if my_next_month == 13:
            my_next_year = my_year + 1
            my_next_month = 1
        my_year_after_this = my_year + 1
        my_year_before_this = my_year - 1
        return render_to_response("cal_template.html", { 'readings_list': my_reading_events,
                                                            'month': my_month,
                                                            'month_name': named_month(my_month),
                                                            'year': my_year,
                                                            'previous_month': my_previous_month,
                                                            'previous_month_name': named_month(my_previous_month),
                                                            'previous_year': my_previous_year,
                                                            'next_month': my_next_month,
                                                            'next_month_name': named_month(my_next_month),
                                                            'next_year': my_next_year,
                                                            'year_before_this': my_year_before_this,
                                                            'year_after_this': my_year_after_this,
        }, context_instance=RequestContext(request))
</code></pre>

<p>And finally, here's the template where we load the template tag and employ it, passing the year, month, and list from the view (you would also want to write some control elements that use previous_year, previous_month, etc. to allow the user to change what the calendar displays, but because I want to wrap this up I'll forgo writing that out):</p>

<pre><code>{% load reading_tags %}

&lt;div id="calendar"&gt;
    {% reading_calendar year month reading_list %}
&lt;/div&gt;
</code></pre>

<p>Hopefully that makes sense. Enjoy!</p>

<p><em>You can also see this code (made generic for any kind of event) <a href="http://djangosnippets.org/snippets/2464/">on django snippets</a>.</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring, spring, spring]]></title>
    <link href="http://williamjohbnert.com/2011/05/spring-spring-spring/"/>
    <updated>2011-05-09T05:59:26-04:00</updated>
    <id>http://williamjohbnert.com/2011/05/spring-spring-spring</id>
    <content type="html"><![CDATA[<p><a href="http://williamjohnbert.com/wp-content/uploads/2011/05/jbb_cr2.jpg"><img src="http://williamjohnbert.com/wp-content/uploads/2011/05/jbb_cr2.jpg" alt="" /></a>Spring is the rarest of seasons in DC, but it looks like we get a few days of it this week. This could not be happening at a better time. The protracted move from Columbia Heights/Baltimore/Tucson to Capitol Hill is over. The <a href="http://www.callandresponsedc.org/">art show</a> has wrapped. Work is still way busy, but next week I head to North Carolina for some writing time in the mountains at <a href="http://doebranchink.org/">Doe Branch Ink</a>--the ideal vacation.</p>

<p>Craig Nova is the resident author for this session at DBI, and I'm looking forward to reading his novel <em>The Good Son</em>, starting on the commute home this afternoon. It'll be good to dive back into reading and writing, which have taken a back seat so far this season. I did have the honor of getting tapped for <a href="http://dcarts.dc.gov/DC/DCARTS/Events/Annual+Programming/Annual+Programming#4">a Larry Neal award</a>, 2nd place for adult fiction  (the non-euphemistic kind), for a story I began back in Arizona but kept revisiting up until last fall. That just made me want to sit down and get back to writing, drafting, and revising even more! I don't have any illusions that late spring and summer will be slow, but few things suck up time more than moving, and with a good solid week to get jump-started, I'm feeling optimistic.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Stuff: Happening]]></title>
    <link href="http://williamjohbnert.com/2011/02/stuff-happening/"/>
    <updated>2011-02-22T15:06:54-05:00</updated>
    <id>http://williamjohbnert.com/2011/02/stuff-happening</id>
    <content type="html"><![CDATA[<p><a href="http://williamjohnbert.com/wp-content/uploads/2011/02/IMG_0746.jpg"><img src="http://williamjohnbert.com/wp-content/uploads/2011/02/IMG_0746.jpg" alt="Plane flying in clouds" /></a>If I updated more regularly, I would have written entire posts about the following things.</p>

<ul>
<li><p>AWP 2011 came and went blazingly fast. I saw many people I've missed dearly, and missed many people I would've liked to see.</p></li>
<li><p>The second workshop with the Bell Poetry Club for <a href="http://www.826dc.org/">826DC</a>, this time diving into the poem-as-extended-metaphor, went swimmingly.</p></li>
<li><p>A story of mine is going to be published in the first issue of Anomalous.</p></li>
<li><p>And I continue working on my reading series Django app. Possible names: Readsr, or Readzee, or Readoo, or maybe Readthing. Hmm. Are any of these, like, any good? Tonight's task: refactoring and adding messaging.</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building the New Call + Response Site]]></title>
    <link href="http://williamjohbnert.com/2011/01/building-the-new-call-response-site/"/>
    <updated>2011-01-26T15:32:03-05:00</updated>
    <id>http://williamjohbnert.com/2011/01/building-the-new-call-response-site</id>
    <content type="html"><![CDATA[<p><a href="http://williamjohnbert.com/wp-content/uploads/2011/01/5391220127_9ed0503fb0_b.jpg"><img src="http://williamjohnbert.com/wp-content/uploads/2011/01/5391220127_9ed0503fb0_b.jpg" alt="National Portrart Gallery in the snow" /></a>Over the past couple weeks I worked on relaunching the website for <a href="http://www.callandresponsedc.org/">Call + Response</a>, an art show I co-curate with my friend <a href="http://twitter.com/kiraface">Kira</a>.</p>

<p>The website for the second iteration of the show, Call + Response: Textures, is pretty different from <a href="http://williamjohnbert.com/callandresponse2010/">the first version</a>. The first was ultra minimal, hand-coded, and didn't use a CMS—just a simple site that I could get going in a matter of hours. It was not designed to coordinate with a promotional campaign incorporating Twitter and Facebook. Even doing regular updates on our progress putting together the show would have been a real pain.</p>

<p>My goal for this site was to keep the clean, minimal feel while using a modern CMS that would allow for frequent updates, integration with social media, and cool stuff like photo galleries, maps, and interactive widgets. So here's what I did.</p>

<ul>
<li><p>First I installed  a Wordpress theme, a rather minimalist one called <a href="http://www.yukei.net/proyectos/satori-english-documentation/">sartorii</a>. Then I started to customize it to the particular needs of the site, slimming it down further, eliminating sidebars and meta information, culling whatever felt extraneous to the site's mission of communicating essentials and focusing on the concept and participants.</p></li>
<li><p>To present the bios of the participants, I used jQuery UI's accordion tool. Call + Response pairs artists with writers, so I wrote code to link two accordions together. When you click on an artist name you get two bios, theirs and the writer they are paired with, and vice versa.</p></li>
<li><p>I installed  a lightbox plugin for the <a href="http://www.callandresponsedc.org/?page_id=65">photos page</a>. First, I discovered just how many lightbox plugins are out there. I wanted one that would integrate with Wordpress's gallery feature, and it took some time to find a solution. I ended up using <a href="http://wordpress.org/extend/plugins/fancy-gallery/">Fancy Gallery</a>, which integrates with <a href="http://fancybox.net/">Fancy Box</a> to produce the desired results.</p></li>
<li><p>Once I received the poster design for the show from our designer, <a href="http://www.olivermunday.com">Oliver Munday</a>, I further customized the theme to use the poster's colors and imagery.</p></li>
</ul>


<p>I'm pleased with the result. I think it fulfills the goals I set forth. I learned a ton about jQuery, css, and WordPress, which was a great side benefit. Picking up new skills can be really enjoyable, especially when  those skills quickly turn into tangible results.</p>

<p>I'm already starting on my  next web development project: building a Django app to manage a list of DC-area reading series.</p>
]]></content>
  </entry>
  
</feed>
